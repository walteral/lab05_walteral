<!doctype html>
<html lang="en" xmlns:display="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>walteral_GEOG572_Lab05</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" >
  <!--<link rel="stylesheet" href="https://dc-js.github.io/dc.js/css/dc.min.css">-->
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
  <!--<script src="https://d3js.org/d3.v5.min.js"></script>-->
  <link rel="stylesheet" href="http://dc-js.github.io/dc.js/css/dc.css">
  <link href="https://fonts.googleapis.com/css?family=Artifika|Cinzel+Decorative" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.12/css/all.css">


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

  <style>

    html, body { width: 100%; height: 100%; margin: 0; padding: 0; background: #fff; font-family: 'Artifika', serif; font-size:16px; position: relative}

    .intro {
        height: 100%;
        width:100%;
        margin: auto;
        background: url(https://images.pexels.com/photos/66090/pexels-photo-66090.jpeg?cs=srgb&dl=adventure-bushcraft-camping-66090.jpg&fm=jpg) no-repeat 50% 50%;
        display: table;
        top: 0;
        background-size: cover;
    }

    .intro .inner {
        display: table-cell;
        vertical-align: middle;
        width: 100%;
        max-width: none;

    }

    .content {
        max-width: 500px;
        margin: 0 auto;
        text-align: center;

    }

    .content h1 {
        font-family: 'Cinzel Decorative', cursive;
        color: #FFFFFF;
        text-shadow: 6px 8px 300px #000000;
        font-size: 500%;
    }
    .btn{
        color: #53626f;
        border-radius: 9px;
        font-family: 'Cinzel Decorative', cursive;
        font-size: 100%;
        padding: 10px 20px;
        fill: #FFFFFF;
        border: solid #53626f 3px;
        text-decoration: none;
        text-transform: uppercase;

    }

    .btn:hover{
        color: #fff;
        border: solid #fff 3px;
    }




    #mag-chart {
      width:100%;
      margin: 0 auto;
    }

    #date-chart {
      width: 100%;
      margin: 0 auto;
    }

    #depth-chart {
        width: 100%;
        margin: 0 auto;
    }

    .dc-data-count {
      width: 100%;
      margin: 0 auto;
    }

    .map {
      width: 70%;
      height: 100%;
      left: 0px;
        position: absolute;

    }
    .side-menu {
        width:available;
        height: 300px;
        right: 0px;
        position: absolute;
    }
    .icon {
        font-size: 16px;
        color: #FFFFFF;
        position: absolute;
        font-family: 'Cinzel Decorative', cursive;
    }


    .scrollbar-black::-webkit-scrollbar-track {
      -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.1);
      background-color: #F5F5F5;
      border-radius: 10px; }

    .scrollbar {

      float: left;
      height: 25%;
      width: 65px;
      background: #fff;
      overflow-y: scroll;
      margin-bottom: 25px;
    }
    .force-overflow {
      min-height: 350px;
    }

    .scrollbar-primary::-webkit-scrollbar {
      width: 12px;
      background-color: #F5F5F5; }

    .scrollbar-primary::-webkit-scrollbar-thumb {
      border-radius: 10px;
      -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.1);
      background-color: #180ef4; }

  </style>

  <script src="https://dc-js.github.io/dc.js/js/d3.js"></script>
  <script src="https://dc-js.github.io/dc.js/js/crossfilter.js"></script>
  <script src="https://dc-js.github.io/dc.js/js/dc.js"></script>
  <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>
    <link rel="shortcut icon" href="assets/img/TFDDicon.JPG" type="image/x-icon">

</head>

<body>


<section class="intro">
    <i class="fab fa-github fa-lg" style="color: #fff; right: 5px; top:5px; position: absolute">
        <a style='color: #FFFFFF; padding: 5px; font-family:Cinzel Decorative;' href="https://github.com/hannahfriedrich/TFDDGeoViz">Github</a></i>
    <i class="fab fa-facebook fa-lg" style="color: #fff; right: 5px; top:25px; position: absolute">
        <a style='color: #FFFFFF; padding: 5px; font-family:Cinzel Decorative;' href="https://github.com/hannahfriedrich/TFDDGeoViz">Facebook</a></i>
    <i class="fa fa-info-circle" style="color: #fff; left: 5px; top:5px; font-size: large; position: absolute"><a data-toggle="modal" data-target="#aboutModal" class='icon'; style='color: #FFFFFF; padding: 5px'>About</a></i>
    <i class="fa fa-plus-circle" style="color: #fff; left: 5px; top:25px; font-size: large; position: absolute"><a data-toggle="modal" data-target="#creditModal" class='icon'; style='color: #FFFFFF; padding: 5px'>Credit</a></i>

    <div class="inner">
        <div class="content">
            <h1>Transnational Fresh Water Dispute Database</h1>
            <a class="btn" href="#"> Get Started</a>
        </div>

    </div>
</section>


<!-- Modal -->
<div class="modal fade" id="aboutModal" role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">

                <h4 class="modal-title">About</h4>
            </div>
            <div class="modal-body">
                <p>The Freshwater Transnational Dispute Database is a global collection of treaties used to settle water disputes.
                </p>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="creditModal" role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">

                <h4 class="modal-title">About</h4>
            </div>
            <div class="modal-body">
                <p> Administrators</p>
                <p>Aaron T. Wolf, Ph.D.
                    Program Co-Director
                    Program in Water Conflict Management and Transformation
                    Oregon State University
                    College of Earth, Ocean, and Atmospheric Sciences
                    104 CEOAS Admin Building
                    Corvallis, OR 97331
                    E-mail: wolfa[a]geo.oregonstate.edu
                    Phone: (541) 737-2722
                    Fax: (541) 737-1200</p>

                <p>
                    Lynette de Silva
                    Program Co-Director
                    Program in Water Conflict Management and Transformation
                    Oregon State University
                    College of Earth, Ocean, and Atmospheric Sciences
                    104 CEOAS Admin Building
                    Corvallis, OR 97331
                    E-mail: desilval[a]geo.oregonstate.edu
                    Phone: (541) 737-7013
                    Fax: (541) 737-1200
                </p>
                <p>
                    Melissa McCracken
                    Database Manager
                    Transboundary Freshwater Dispute Database
                    Oregon State University
                    College of Earth, Ocean, and Atmospheric Sciences
                    104 CEOAS Admin Building
                    Corvallis, OR 97331
                    E-mail: mccrackm[a]oregonstate.edu
                </p>
                <br><br>
                <p>Website creators</p>
                <p> The project is created by Hannan Friedrich, Govanni Svevo and Alex Walters</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!--<div class="modal fade" id="creditsModal" role="dialog">-->
    <!--<div class="modal-dialog modal-lg">-->
        <!--<div class="modal-content">-->
            <!--<div class="modal-header">-->

                <!--<h4 class="modal-title">Credis</h4>-->
            <!--</div>-->
            <!--<div class="modal-body">-->
                <!--<p>-->
                    <!--This webpage was created using the following libraries: Leaflet, Bootstrap, Jquery, font=awesome, D3-->
                    <!--Video Credits: "The Unseen Afghanistan", YouTube video, 3:35, posted by Khyber Khan, Nov 20, 2016, https://www.youtube.com/watch?v=JDrScVo7aBs<br>-->
                    <!--End photo credits: https://userscontent2.emaze.com/images/7d765166-02ae-4221-b3a4-c755f5e8827a/32509c83-ac87-4dc2-8f67-7fe76a86e8b0.jpg <br>-->
                    <!--Country shapefiles:http://www.gadm.org/download<br>-->
                    <!--Picture sources: https://www.globalresearch.ca/afghanistan-britain-is-protecting-the-biggest-heroin-crop-of-all-time/6405; <br>-->
                    <!--http://www.freemalaysiatoday.com/category/world/2017/08/08/from-poppy-to-heroin-taliban-move-into-afghan-drug-production/;<br>-->
                    <!--http://www.railwaypro.com/wp/the-historical-silk-road-reinvented-on-railways/; http://www.balkaninsight.com/en/article/drug-lord-shot-in-%D0%B0-gunfight-at-bulgarian-sea-resort-06-09-2016;<br>-->
                    <!--https://www.expresstorussia.com/moscow-tours.html; https://www.vice.com/en_us/article/vdxegj/french-connection-kevin-perry-marseille; http://www.cnn.com/2017/07/31/asia/india-heroin-drug-bust/index.html; <br>-->
                    <!--https://www.statista.com/statistics/269857/most-profitable-companies-worldwide/-->

                    <!--Icon: <div>Icons made by <a href="http://www.freepik.com" title="Freepik">Freepik</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a> is licensed by <a href="http://creativecommons.org/licenses/by/3.0/" title="Creative Commons BY 3.0" target="_blank">CC 3.0 BY</a></div>-->

                <!--</p>-->
            <!--</div>-->
            <!--<div class="modal-footer">-->
                <!--<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>-->
            <!--</div>-->
        <!--</div>-->
    <!--</div>-->
<!--</div>-->

<div id="map" class="map">


    <div id="data-table" class="container table-striped table-bordered scrollbar scrollbar-primary" style= "width: 100%; position: absolute; bottom: 0px; left: 0px; z-index: 1000">


        <input class="form-control" id="myInput" type="text" placeholder="Search...">
        <span class="col-sm-2">BCODE</span>
        <span class="col-sm-4">Basin Name</span>
        <!--<span class="col-sm-2">Continent</span>-->
        <!--<span class="col-sm-2"></span>-->
        <span class="col-sm-3">Area (Km2)</span>
        <span class="col-sm-2">Population Density</span>
        <span class="col-sm-1">Existing Dams</span>
        <table id="myTable" class="table table-hover dc-data-table table-condensed force-overflow"></table>

    </div>
</div>

<div>


    <div class="dc-data-count">
        <span class="filter-count"></span> selected out of <span class="total-count"></span> records |<a
            href="javascript:dc.filterAll();dcrederAll();">Reset All</a>
    </div>
    <div class="container-fluid side-menu" >
        <div class="row">
            <div id="popCount">
                <strong> Population Density per Basin</strong>
                <span class="reset" style="display: none;">Selected: <span class="filter"></span></span>
                <a class="reset" href="javascript:popdimChart.filterAll();dc.redrawAll();"style="display:none;">reset</a>
                <div class="clearfix"></div>
            </div>
        </div>
        <div class="row">
            <div id="areaChart">
                <strong> Area per Basin</strong>
                <span class="reset" style="display: none;">Selected: <span class="filter"></span></span>
                <a class="reset" href="javascript:areadimChart.filterAll();dc.redrawAll();"style="display:none;">reset</a>
                <div class="clearfix"></div>
            </div>
        </div>
    </div>

</div>



</div>



<script>
 var areadimChart = dc.rowChart("#areaChart");
 var popdimChart = dc.pieChart("#popCount");
 var visCount = dc.dataCount(".dc-data-count");
 var visTable = dc.dataTable("#myTable");

// create a map object for us to input the map and it's components into.
var map = L.map('map', {zoomControl: false, scrollWheelZoom: true}).setView([0,0], 1);
L.tileLayer('http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png').addTo(map);

//add in the .csv file .then() run the functions on that data
d3.json('assets/basins_simplified.geojson').then(function(data) {



//////////////////////////////////////////////////PREP THE DATA////////////////////////////////////////////////////////
  //create crossfilter passes each feature to the filter
  var filter = crossfilter(data.features); //passes the features to the crossfilter
// groups everything together into one group, this is used to quickly search all of the data at once
  var all = filter.groupAll();

  var geometry = filter.dimension(function(d) {
      return d.geometry
      });


//Takes each of the records of the dataset and returns each individual line so that they can be used. .dimension() puts
// the data into an easily searchable/manipulable format for DC
  var everything = filter.dimension(function(d) {
    return d
  });

//////////////////////////////////////////////SORT THE DATA///////////////////////////////////////////////////////////
//returns the geometry for each feature; this is the points at which each earthquake happened
  var popDimension = filter.dimension(function(d) {
      var pop = d.properties.PopDen2015;
      return  pop < 50 ? '0-50' :
          pop < 75 ? '50-75' :
              pop <   100 ? '75-100' :
                  pop < 125 ? '100-125' :
                      pop <   150 ? '125-150' :
                          '>150'


  });

    var areaDim = filter.dimension(function(d) {
        var area = d.properties.Area_km2
        return  area < 10000 ? '0-10000' :
            area < 20000 ? '10000 - 20000' :
                area <   30000 ? '20000 - 30000' :
                    area < 40000 ? '30000 - 40000' :
                        area <  50000 ? '40000 - 50000' :
                            '>50000'
    });

    var codeDim = filter.dimension(function (d) {
        var BCODE = d.properties.BCODE
        return BCODE
    })
    var codeGroup = codeDim.group()
/////////////////////////////////////////GROUP THE DATA///////////////////////////////////////////////////////////////
// Now that we have the mag dimension captured in an object we have to group them all together so that we can use them
 var popGroup = popDimension.group();
    var areaGroup = areaDim.group()



///////////////////////////////////////////////ADD THE MARKERS TO THE MAP///////////////////////////////////////////////
  var geoJsonLayer = L.geoJson({
    type: 'FeatureCollection',
    features: geometry.top(Infinity)//starts selecting from the .top() and goes until...infinity
  }, {
    // pointToLayer: function (feature, latlng) {
    //   return L.circleMarker(latlng, {
    //     radius: Math.pow(feature.properties.mag, 2)/2,
    //     fillColor: "steelblue",
    //     color: "#fff",
    //     weight: 1,
    //     stroke: false,
    //     opacity: 0.1,
    //     fillOpacity: 0.1
    //   })
    // },
    onEachFeature: function (feature, layer) {
        layer.bindTooltip(feature.properties.Basin_Name.toString());
    }
  }).addTo(map);

/////////////////////////////////////CREATE THE CHARTS////////////////////////////////////////////////////////////////

    popdimChart
        .height(300)
        .width(400)
        .slicesCap(4)
        .innerRadius(100)
        .externalLabels(40)
        .externalRadiusPadding(60)
        .drawPaths(true)
        .dimension(popDimension)
        .group(popGroup)
        // .legend(dc.legend());;


    areadimChart
        .dimension(areaDim)
        .group(areaGroup)
        .elasticX(true);

    visCount
        .dimension(filter)
        .group(all);

    visTable
        .dimension(codeDim)
        .group(function(d){
            return d
        })

        .columns([
                function(d) {return d.properties.BCODE},
                function(d) {return d.properties.Basin_Name},
                // function(d) {return d.properties.Continent_},
                function(d) {return d.properties.Area_km2},
                function(d) {return d.properties.PopDen2015},
                function(d) {return d.properties.Dams_Exist}
        ]);


    dc.renderAll()
});

////////////////////////////////////////LISTEN FOR CHANGES ON THE MAP//////////////////////////////////////////////////

 $(document).ready(function(){
     $("#myInput").on("keyup", function() {
         var value = $(this).val().toLowerCase();
         $("#myTable tr").filter(function() {
             $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
         });
     });


 });

//define in functions what we want to have happen to the map
    //This function sees which features are in the bounding box and returns the points that are in it; This filters the
    //data for the charts and map.
//     function updateMapFilter() {
//         geomDimension.filter(function(d) {
//             return map.getBounds().contains(L.geoJSON(d).getBounds())
//         });
//         dc.redrawAll();
// //     }
// //
//     function updateMap() {
//         geoJsonLayer.clearLayers();//removes everything
//         geoJsonLayer.addData({//adds the new data to the map/chart within the scope of the filter
//             type: 'FeatureCollection',
//             features: everything.top(Infinity)
//         });
//     }
//
//
//
// //When the chart is "filtered" it runs the function to update the map
//   popdimChart.on('filtered', function(chart, filter) {
//     updateMap()//calls the update map function
//   });
//
//   areadimChart.on('filtered', function(chart, filter) {
//     updateMap()
//   });
//   //
//   // dateChart.on('filtered', function(chart, filter) {
//   //   updateMap()
//   // });
//


</script>
</body>
</html>